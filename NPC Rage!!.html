<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPC Rage!!</title>
    <style>
        body {
            font-family: Brush Script MT, cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            background-color: #f0f0f0;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            grid-template-rows: repeat(10, 40px);
            gap: 2px;
            border: 2px solid #000;
            margin-bottom: 20px;
        }

        .cell {
            width: 40px;
            height: 40px;
            background-color: white;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .player {
            width: 30px;
            height: 30px;
            background-color: red;
            border-radius: 50%;
            position: relative;
            transition: width 0.3s, height 0.3s;
        }

        .npc {
            width: 30px;
            height: 30px;
            background-color: blue;
            border-radius: 50%;
        }

        .name-tag {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            padding: 3px 5px;
            border-radius: 5px;
            font-size: 12px;
            border: 1px solid #ccc;
            color: #333;
        }

        .score, .points {
            font-size: 20px;
            margin-top: 10px;
        }

        .name-input {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .upgrades {
            margin-top: 20px;
        }

        .upgrade-button {
            padding: 10px;
            background-color: #00ff00;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .upgrade-button:hover {
            background-color: #00cc00;
        }
    </style>
</head>
<body>

    <h1>NPC Rage!!</h1>

    <!-- Player Name Input -->
    <div class="name-input">
        <label for="playerName">Enter your name: </label>
        <input type="text" id="playerName" placeholder="Enter name" />
        <button id="startGameButton">Start Game</button>
    </div>

    <div class="game-board" id="gameBoard">
        <!-- Game grid cells will be dynamically generated -->
    </div>

    <div class="score" id="score">Size: 30</div>
    <div class="points" id="points">Points: 0</div>

    <!-- Upgrades Section -->
    <div class="upgrades">
        <button class="upgrade-button" id="upgradeRange">Upgrade Range (Cost: 20 points)</button>
        <button class="upgrade-button" id="upgradeSize">Upgrade Size (Cost: 30 points)</button>
    </div>

    <script>
        let playerPosition = { x: 5, y: 5 }; // Start in the middle of the grid
        let playerSize = 30; // Initial player size
        let playerGrowthRate = 10; // Growth rate of the player
        let playerRange = 1; // Initial range to eat NPCs
        let playerName = ''; // Store player name
        let playerDiv; // Reference to the player div
        let npcs = []; // Array to hold NPC positions
        let points = 0; // Player points

        const gameBoard = document.getElementById('gameBoard');
        const scoreElement = document.getElementById('score');
        const pointsElement = document.getElementById('points');
        const nameInput = document.getElementById('playerName');
        const startGameButton = document.getElementById('startGameButton');
        const upgradeRangeButton = document.getElementById('upgradeRange');
        const upgradeSizeButton = document.getElementById('upgradeSize');
        const gridSize = 10; // Size of the grid (10x10)

        // Generate the game grid dynamically based on the grid size
        function createGameGrid() {
            for (let x = 0; x < gridSize; x++) {
                for (let y = 0; y < gridSize; y++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.id = `cell-${x}-${y}`;
                    gameBoard.appendChild(cell);
                }
            }
        }

        // Function to generate new NPCs at random positions
        function generateNpcs() {
            npcs = [];
            for (let i = 0; i < 10; i++) { // Generate 10 NPCs
                let x, y;
                do {
                    x = Math.floor(Math.random() * gridSize);
                    y = Math.floor(Math.random() * gridSize);
                } while (npcs.some(npc => npc.x === x && npc.y === y) || (x === playerPosition.x && y === playerPosition.y)); // Ensure no overlap with player
                npcs.push({ x, y });
            }
        }

        // Function to update the player's position and size
        function updatePlayerPosition() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.innerHTML = ''; // Clear all cells
            });

            const playerCell = document.getElementById(`cell-${playerPosition.x}-${playerPosition.y}`);
            playerDiv = document.createElement('div');
            playerDiv.classList.add('player');
            playerDiv.style.width = `${playerSize}px`;
            playerDiv.style.height = `${playerSize}px`;
            playerCell.appendChild(playerDiv);

            // Create and show the player's name over their head
            const nameTag = document.createElement('div');
            nameTag.classList.add('name-tag');
            nameTag.textContent = playerName;  // Set the player's name
            playerCell.appendChild(nameTag);

            // Check if the player eats any NPCs within range
            npcs.forEach((npc, index) => {
                const distance = Math.sqrt(Math.pow(playerPosition.x - npc.x, 2) + Math.pow(playerPosition.y - npc.y, 2));
                if (distance <= playerRange) {
                    // Remove the NPC, grow the player, and increase the score and points
                    npcs.splice(index, 1); // Remove NPC from the array
                    playerSize += playerGrowthRate; // Increase player's size
                    points += 5; // Gain 5 points per NPC
                    scoreElement.textContent = `Size: ${playerSize}`; // Update the size display
                    pointsElement.textContent = `Points: ${points}`; // Update points display
                }
            });

            // Add NPCs back to their respective positions
            npcs.forEach(npc => {
                const npcCell = document.getElementById(`cell-${npc.x}-${npc.y}`);
                const npcDiv = document.createElement('div');
                npcDiv.classList.add('npc');
                npcCell.appendChild(npcDiv);
            });

            // If all NPCs are eaten, reset the game and player's size
            if (npcs.length === 0) {
                resetGame();
            }
        }

        // Function to reset the game, NPCs, and player's size
        function resetGame() {
            playerSize = 30; // Reset player size to initial value
            scoreElement.textContent = `Size: ${playerSize}`; // Reset score display
            generateNpcs(); // Reset NPCs
            updatePlayerPosition(); // Reposition player
        }

        // Upgrade player range (cost: 20 points)
        upgradeRangeButton.addEventListener('click', () => {
            if (points >= 20) {
                points -= 20;
                playerRange += 1; // Increase range by 1 cell
                pointsElement.textContent = `Points: ${points}`;
                alert('Range upgraded! You can eat NPCs from a greater distance.');
            } else {
                alert('Not enough points for Range upgrade!');
            }
        });

        // Upgrade player size (cost: 30 points)
        upgradeSizeButton.addEventListener('click', () => {
            if (points >= 30) {
                points -= 30;
                playerGrowthRate += 5; // Increase growth rate
                pointsElement.textContent = `Points: ${points}`;
                alert('Size upgrade! You will grow faster.');
            } else {
                alert('Not enough points for Size upgrade!');
            }
        });

        // Function to make NPCs move away from the player
        function moveNpcAway(npc) {
            const directions = [
                { x: -1, y: 0 }, // Up
                { x: 1, y: 0 }, // Down
                { x: 0, y: -1 }, // Left
                { x: 0, y: 1 }  // Right
            ];

            // Find direction to move away from the player
            let bestMove = null;
            let maxDistance = -1;

            directions.forEach(direction => {
                const newX = npc.x + direction.x;
                const newY = npc.y + direction.y;
                const distance = Math.sqrt(Math.pow(playerPosition.x - newX, 2) + Math.pow(playerPosition.y - newY, 2));

                // Check if the move is within bounds
                if (newX >= 0 && newX < gridSize && newY >= 0 && newY < gridSize) {
                    if (distance > maxDistance) {
                        maxDistance = distance;
                        bestMove = { x: newX, y: newY };
                    }
                }
            });

            // Update NPC position
            if (bestMove) {
                npc.x = bestMove.x;
                npc.y = bestMove.y;
            }
        }

        // Handle player click to move
        gameBoard.addEventListener('click', event => {
            const cellId = event.target.id;
            if (!cellId) return;

            const [cellX, cellY] = cellId.split('-').slice(1).map(Number);
            if (cellX >= 0 && cellX < gridSize && cellY >= 0 && cellY < gridSize) {
                playerPosition.x = cellX;
                playerPosition.y = cellY;
                updatePlayerPosition();
            }
        });

        // Start game function
        function startGame() {
            playerName = nameInput.value.trim();
            if (!playerName) {
                alert("Please enter a name to start the game!");
                return;
            }

            // Hide name input and start the game
            document.querySelector('.name-input').style.display = 'none';
            resetGame(); // Initialize NPCs and reset player size
        }

        // Move NPCs every second
        setInterval(() => {
            npcs.forEach(moveNpcAway);
            updatePlayerPosition(); // Recheck player position after NPC movement
        }, 1000);

        startGameButton.addEventListener('click', startGame);

        // Initialize the grid on page load
        createGameGrid();
    </script>
</body>
</html>
